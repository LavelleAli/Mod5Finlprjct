<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Starfield</title>

<style>
html,body{margin:0;padding:0;background:#000;overflow:hidden;}
canvas{display:block;}
</style>
</head>
<body>

<canvas id="space"></canvas>

<script>
const canvas = document.getElementById("space");
const ctx = canvas.getContext("2d",{alpha:false});

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize",resize);
resize();

/* ===== Direction: bottom-left â†’ top-right ===== */
const VX=1, VY=-1;
const mag=Math.hypot(VX,VY);
const dirX=VX/mag;
const dirY=VY/mag;

/* ===== Motion ===== */
const DRIFT_SPEED=0.10;
const ACTIVE_SPEED=0.42;
const ACTIVE_DECAY_MS=900;

const PARALLAX_STRENGTH=38;

let mouseX=canvas.width/2;
let mouseY=canvas.height/2;
let lastMoveAt=performance.now();

window.addEventListener("mousemove",e=>{
  mouseX=e.clientX;
  mouseY=e.clientY;
  lastMoveAt=performance.now();
});

function rand(min,max){return Math.random()*(max-min)+min;}

const STAR_COUNT=520;
const NEAR_Z_THRESHOLD=2.6;

const stars=[];

function makeStar(){
  const z=rand(0.6,3.2);

  return{
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    z,
    size:rand(0.6,1.8)*(z/2.2),
    baseAlpha:rand(0.35,0.95),

    /* shimmer */
    twPhase:rand(0,Math.PI*2),
    twSpeed:rand(0.015,0.045),
    twAmp:rand(0.10,0.35),

    /* glimmer bursts */
    glimmerTimer:rand(0,600),
    glimmerStrength:0
  };
}

for(let i=0;i<STAR_COUNT;i++)stars.push(makeStar());

function wrapStar(s){
  if(s.x>canvas.width+6)s.x=-6;
  if(s.y<-6)s.y=canvas.height+6;
  if(s.x<-6)s.x=canvas.width+6;
  if(s.y>canvas.height+6)s.y=-6;
}

function currentSpeed(now){
  const dt=now-lastMoveAt;
  const t=Math.min(1,dt/ACTIVE_DECAY_MS);
  return ACTIVE_SPEED*(1-t)+DRIFT_SPEED*t;
}

function draw(now){

  ctx.fillStyle="rgb(0,0,12)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const cx=canvas.width/2;
  const cy=canvas.height/2;

  const mx=(mouseX-cx)/canvas.width;
  const my=(mouseY-cy)/canvas.height;

  const base=currentSpeed(now);

  for(const s of stars){

    /* movement */
    const speed=base*s.z;
    s.x+=dirX*speed;
    s.y+=dirY*speed;

    /* shimmer */
    s.twPhase+=s.twSpeed;
    const twinkle=1+Math.sin(s.twPhase)*s.twAmp;

    /* glimmer burst logic */
    s.glimmerTimer--;
    if(s.glimmerTimer<=0){
      s.glimmerStrength=rand(0.6,1.3);
      s.glimmerTimer=rand(250,900);
    }
    s.glimmerStrength*=0.92;

    const alpha=Math.min(
      1,
      Math.max(
        0,
        s.baseAlpha*twinkle + s.glimmerStrength*0.25
      )
    );

    const parallax=PARALLAX_STRENGTH*(s.z/3.2);
    const px=s.x+mx*parallax;
    const py=s.y+my*parallax;

    const bright=Math.floor(200+(s.z/3.2)*55);

    /* glow for close stars */
    if(s.z>=NEAR_Z_THRESHOLD){
      ctx.shadowColor=`rgba(${bright},${bright},${bright},${alpha})`;
      ctx.shadowBlur=10 + s.glimmerStrength*8;
    }else{
      ctx.shadowBlur=0;
    }

    ctx.fillStyle=`rgba(${bright},${bright},${bright},${alpha})`;

    ctx.beginPath();
    ctx.arc(px,py,s.size,0,Math.PI*2);
    ctx.fill();

    /* sparkle spikes during glimmer */
    if(s.glimmerStrength>0.4){
      ctx.strokeStyle=`rgba(255,255,255,${alpha*0.6})`;
      ctx.lineWidth=1;

      ctx.beginPath();
      ctx.moveTo(px-3,py);
      ctx.lineTo(px+3,py);
      ctx.moveTo(px,py-3);
      ctx.lineTo(px,py+3);
      ctx.stroke();
    }

    wrapStar(s);
  }

  ctx.shadowBlur=0;

  requestAnimationFrame(draw);
}

requestAnimationFrame(draw);
</script>

</body>
</html>
